<!doctype html>
<html lang="en">
  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- load bootstrap -->
  <link rel="stylesheet" href="/assets/css/bootstrap.min.css">
  <script src="/assets/js/bootstrap.bundle.min.js"></script>

  <!-- user -->
  
    <link rel="shortcut icon" type="image/png" href="/assets/images/SparklingCorrelation-icon.png">
  
  <link rel="stylesheet" href="/assets/css/open-color.css">
  <link rel="stylesheet" href="/assets/css/styles.css">
  <script src="/assets/js/main.js"></script>

  <!-- font awesome -->
  <script async src="https://use.fontawesome.com/releases/v5.0.12/js/all.js"></script>

  <link type="application/atom+xml" rel="alternate" href="https://sparklingcorrelation.com/feed.xml" title="Sparkling Correlation" />
  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>SEM Estimation by 2SLS | Sparkling Correlation</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="SEM Estimation by 2SLS" />
<meta name="author" content="Stephen Lee" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Overview" />
<meta property="og:description" content="Overview" />
<link rel="canonical" href="https://sparklingcorrelation.com/2021/05/07/sem-iv.html" />
<meta property="og:url" content="https://sparklingcorrelation.com/2021/05/07/sem-iv.html" />
<meta property="og:site_name" content="Sparkling Correlation" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-05-07T00:00:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="SEM Estimation by 2SLS" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"Stephen Lee"},"url":"https://sparklingcorrelation.com/2021/05/07/sem-iv.html","headline":"SEM Estimation by 2SLS","dateModified":"2021-05-07T00:00:00-05:00","datePublished":"2021-05-07T00:00:00-05:00","description":"Overview","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://sparklingcorrelation.com/2021/05/07/sem-iv.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  

</head>

  <body>
    <div id="main" class="container">

      <nav class="navbar navbar-expand-lg fixed-top navbar-light py-4" id="menu">

  <!-- BRAND LOGO OR NAME -->
  <a class="navbar-brand top" id="site-logo" href="/">
    
      <img class="navbar-brand-img" src="/assets/images/SparklingCorrelation.png" alt="">
    
  </a>
  
  <!-- NAVIGATION -->
  
    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    
    <div class="collapse navbar-collapse justify-content-end" id="navbarCollapse">
      <div class="navbar-nav">
      
        
        <a class="nav-item nav-link " href="/index.html">Home</a>
      
        
        <a class="nav-item nav-link " href="/categories.html">Categories</a>
      
        
        <a class="nav-item nav-link " href="/archive.html">Archive</a>
      
      </div>
    </div>
  
</nav>


      <main>
        <!-- jquery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script src="/assets/js/adjustAnchorLink.js"></script>
<script src="/assets/js/liveTOCScroll.js"></script>

<div class="post-body">
  <div class="row post-header">
    <div class="col">
      <h1 class="post-title text-center">SEM Estimation by 2SLS</h1>
      <div class="post-meta text-center">

        
          
            <span class="post-metadata" itemprop="author" itemscope itemtype="http://schema.org/Person">
              Stephen Lee -
            </span>
            
          
        

        
        <time class="post-metadata" datetime="2021-05-07T00:00:00-05:00" itemprop="datePublished">
          May 07, 2021
        </time>
        
      </div>
    </div>
  </div>

  <div class="row">

    <!-- START COL WITH TOC -->
    <div class="col-sm-2 pt-3">
      <div class="toc-div py-3">
  
    <h3 class="toc-title">Table of Contents</h3>
  
  <ul class="toc"><li><a href="#overview">Overview</a></li><li><a href="#microeconomic-theory">Microeconomic Theory</a></li><li><a href="#simulation">Simulation</a><ul><li><a href="#setup">Setup</a></li><li><a href="#build-dataset">Build Dataset</a></li><li><a href="#graph">Graph</a></li><li><a href="#intuition-for-first-stage">Intuition for First Stage</a></li><li><a href="#regression-results">Regression Results</a><ul><li><a href="#only-supply-shifters-in-first-stage">Only Supply Shifters in First Stage</a></li><li><a href="#all-exogenous-variables-in-first-stage">All Exogenous Variables in First Stage</a></li></ul></li></ul></li></ul>

</div>

    </div>

    <!-- MAIN POST -->
    <div class="col-sm-10 post p-4">
        <h2 id="overview">Overview</h2>

<p>The goal is to:</p>

<ol>
  <li>Determine the correct setup for the first stage regression, and</li>
  <li>Provide intuition for why that is the case.</li>
</ol>

<h2 id="microeconomic-theory">Microeconomic Theory</h2>
<p>Suppose the true supply function for some product is given by price, and one (or more) exogenous supply shifers \(Z_{supply}\). To make this concrete, consider the beef and steak products, where exogenous supply shifters would be inputs like the price of land, cattle feed, and so on.</p>

\[\begin{aligned}
    Q_{supply} &amp;= f(P_{supply}, \, Z_{supply})
\end{aligned}\]

<p>and similarly, demand is given by:</p>

\[\begin{aligned}
    Q_{demand} &amp;= f(P_{demand}, \, Z_{demand}) 
\end{aligned}\]

<p>If we observe transaction data in a competitive market, we will assume that prices and quantities are in equilibrium, thus implying:</p>

\[P_{supply} = P_{demand} = P^*\]

<p>and</p>

\[Q_{supply} = Q_{demand} = Q^*\]

<p>Together, we can find the reduced form equation for the equilibrium values:</p>

\[\begin{aligned}
    Q_{demand} &amp;= Q_{supply} \\
    f(P^*, \, Z_{demand}) &amp;= f(P^*, \, Z_{supply}) \\ \\
    P^* &amp;= f(Z_{demand}, Z_{supply}) 
\end{aligned}\]

<p>Similarly, we can solve equilibrium quantity as:</p>

\[\begin{aligned}
    f(Q^*, \, Z_{demand}) &amp;= f(Q^*, \, Z_{supply}) \\ \\
    Q^* &amp;= f(Z_{demand}, Z_{supply}) 
\end{aligned}\]

<p><br />
\(\textcolor{red}{NOTE}\): In equilibrium, price and quantity only depend on the exogenous supply and demand shifters.</p>

<h2 id="simulation">Simulation</h2>

<p>Using this theory as a guide, we can build a simulation dataset with the following linear functional forms:</p>

<h3 id="setup">Setup</h3>

\[\begin{aligned}
    P_{supply} &amp;= Q_{supply} + 2Z_{supply} + u_{supply}
\end{aligned}\]

<p>and similarly, demand is given by:</p>

\[\begin{aligned}
    P_{demand} &amp;= 100 - Q_{demand} + 2Z_{demand} + u_{demand}
\end{aligned}\]

<p>Which gives us the reduced form relationships:</p>

\[\begin{aligned}
    P^* = 50 + Z_{supply} + Z_{demand} + v 
\end{aligned}\]

<p>Where \(v = \frac{u_{demand} - u_{supply}}{2}\) contains the errors for both supply and demand.</p>

<h3 id="build-dataset">Build Dataset</h3>
<p>Using this relationship, we can create a simulation dataset as follows:</p>

<ol>
  <li>Generate random values for \(u_{demand}\), \(u_{supply}\), \(Z_{demand}\), and \(Z_{supply}\).</li>
  <li>Use these to find equilibrium prices.</li>
  <li>Back out equilibrium quantities from the supply or demand equation (and verify that they are in fact the same).</li>
  <li>Finally, we only keep positive values for price and quantity since a firm would simply shut down if that were the case.</li>
</ol>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># number of observations to generate</span><span class="w">
</span><span class="n">N</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">100</span><span class="w">

</span><span class="c1"># ud and us are exogenous ~ N(0, 1)</span><span class="w">
</span><span class="n">ud</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="w"> 
</span><span class="n">us</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="w"> 
</span><span class="n">v</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="n">ud</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">us</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">2</span><span class="w">

</span><span class="c1"># supply and demand shifters are exogenous normal</span><span class="w">
</span><span class="c1"># although I believe the distributional assumptions </span><span class="w">
</span><span class="c1"># can be relaxed</span><span class="w">
</span><span class="n">z1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">2</span><span class="w">  </span><span class="c1"># ~N(2, 2)</span><span class="w">
</span><span class="n">z2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">3</span><span class="w">      </span><span class="c1"># ~N(3, 0)</span><span class="w">

</span><span class="c1"># price in equilibrium using reduced form equation</span><span class="w">
</span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">50</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">v</span><span class="w"> 

</span><span class="c1"># verify quantities are the same in equilibrium!</span><span class="w">
</span><span class="n">qd</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">2</span><span class="o">*</span><span class="n">z2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ud</span><span class="w">
</span><span class="n">qs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">2</span><span class="o">*</span><span class="n">z1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">us</span><span class="w">
</span><span class="n">q</span><span class="w">  </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">qd</span><span class="w">

</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nf">sum</span><span class="p">(</span><span class="n">qd</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">qs</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">1e10</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">cat</span><span class="p">(</span><span class="s2">"ERROR: Supply and demand not in equilibrium"</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># make dataset </span><span class="w">
</span><span class="c1"># we only keep values where quantiy and price </span><span class="w">
</span><span class="c1"># are greater than zero. Our simulated datset may </span><span class="w">
</span><span class="c1"># contain negative values since non-zero conditions </span><span class="w">
</span><span class="c1"># are economic assumptions. </span><span class="w">
</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tibble</span><span class="p">(</span><span class="w">
        </span><span class="s2">"Q"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="p">,</span><span class="w"> 
        </span><span class="s2">"P"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> 
        </span><span class="s2">"Z_Supply"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">z1</span><span class="p">,</span><span class="w"> 
        </span><span class="s2">"Z_Demand"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">z2</span><span class="w">
    </span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">filter</span><span class="p">(</span><span class="w">
        </span><span class="n">Q</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">P</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="w">
    </span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h3 id="graph">Graph</h3>

<p>After generating a dataset according to those rules, we can view market prices and quantities in a scatter plot:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ymin</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">P</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">5</span><span class="w">
</span><span class="n">ymax</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">P</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">5</span><span class="w">
</span><span class="n">data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
    </span><span class="n">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> 
    </span><span class="n">ylim</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span><span class="w"> </span><span class="n">ymax</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
    </span><span class="n">theme_wsj</span><span class="p">()</span><span class="w"> 
</span></code></pre></div></div>

<p><img src="/assets/images/sem-scatter.png" alt="scatter" width="500" /></p>

<p>If we lock in some value of \(Z_{demand}\) and \(Z_{supply}\), we can easily see how supply and demand intersect.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">z1_fixed1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">Z_Supply</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w">
</span><span class="n">z1_fixed2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">Z_Supply</span><span class="p">[</span><span class="m">2</span><span class="p">]</span><span class="w">
</span><span class="n">z1_fixed3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">Z_Supply</span><span class="p">[</span><span class="m">3</span><span class="p">]</span><span class="w">

</span><span class="n">z2_fixed1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">Z_Demand</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w">
</span><span class="n">z2_fixed2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">Z_Demand</span><span class="p">[</span><span class="m">2</span><span class="p">]</span><span class="w">
</span><span class="n">z2_fixed3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">Z_Demand</span><span class="p">[</span><span class="m">3</span><span class="p">]</span><span class="w">

</span><span class="n">data</span><span class="o">$</span><span class="n">Qs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">dim</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="m">1</span><span class="p">]</span><span class="w">
</span><span class="n">data</span><span class="o">$</span><span class="n">Ps1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">Qs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">z1_fixed1</span><span class="w">
</span><span class="n">data</span><span class="o">$</span><span class="n">Ps2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">Qs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">z1_fixed2</span><span class="w">
</span><span class="n">data</span><span class="o">$</span><span class="n">Ps3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">Qs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">z1_fixed3</span><span class="w">

</span><span class="n">data</span><span class="o">$</span><span class="n">Qd</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">Qs</span><span class="w">
</span><span class="n">data</span><span class="o">$</span><span class="n">Pd1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">Qd</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">z2_fixed1</span><span class="w">
</span><span class="n">data</span><span class="o">$</span><span class="n">Pd2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">Qd</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">z2_fixed2</span><span class="w">
</span><span class="n">data</span><span class="o">$</span><span class="n">Pd3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">Qd</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">z2_fixed3</span><span class="w">

</span><span class="n">xmin</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">Q</span><span class="p">)</span><span class="w">
</span><span class="n">xmax</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">Q</span><span class="p">)</span><span class="w">
</span><span class="n">ymin</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">P</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">5</span><span class="w">
</span><span class="n">ymax</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">P</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">5</span><span class="w">
</span><span class="n">data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
    </span><span class="n">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> 
    </span><span class="n">geom_line</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">Qs</span><span class="p">,</span><span class="w"> </span><span class="n">Ps1</span><span class="p">),</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
    </span><span class="n">geom_line</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">Qd</span><span class="p">,</span><span class="w"> </span><span class="n">Pd1</span><span class="p">),</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
    </span><span class="n">xlim</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span><span class="w"> </span><span class="n">xmax</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
    </span><span class="n">ylim</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span><span class="w"> </span><span class="n">ymax</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
    </span><span class="n">theme_wsj</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<p><img src="/assets/images/sem-scatter-line.png" alt="lines" width="500" /></p>

<h3 id="intuition-for-first-stage">Intuition for First Stage</h3>

<p>If we are trying to estimate demand elasticity by 2SLS, the naive regression of</p>

\[P = \beta_1 Q + \beta_2 Z_{demand}\]

<p>We will get a biased estimate for \(\beta_1\). Intuitively, this is because price and quantity were determined in equilibrium. In other words, conditional on the exogenous supply and demand shifters (\(Z_{demand}\) and \(Z_{supply}\)), there is no variation in price or quantity.</p>

<p>Instead, we will rely on exogenous variation that only impacts quantity through supply, in this case the supply shifters \(Z_{supply}\). We can think of this as using exogenous shifts in the \(\textcolor{red}{red}\) line to help determine the slope of the \(\textcolor{blue}{blue}\) line.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
    </span><span class="n">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> 
    </span><span class="n">geom_line</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">Qs</span><span class="p">,</span><span class="w"> </span><span class="n">Ps1</span><span class="p">),</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
    </span><span class="n">geom_line</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">Qs</span><span class="p">,</span><span class="w"> </span><span class="n">Ps2</span><span class="p">),</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="n">linetype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"dashed"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
    </span><span class="n">geom_line</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">Qs</span><span class="p">,</span><span class="w"> </span><span class="n">Ps3</span><span class="p">),</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="n">linetype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"dashed"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
    </span><span class="n">geom_line</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">Qd</span><span class="p">,</span><span class="w"> </span><span class="n">Pd1</span><span class="p">),</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
    </span><span class="n">xlim</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span><span class="w"> </span><span class="n">xmax</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
    </span><span class="n">ylim</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span><span class="w"> </span><span class="n">ymax</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">theme_wsj</span><span class="p">()</span><span class="w"> 
</span></code></pre></div></div>

<p><img src="/assets/images/sem-scatter-shifters.png" alt="lines" width="500" /></p>

<p>Finally, why is that that we include the demand shifters in the first equation? Intuitively, this helps to isolate which level of the curves we are looking at. For example, for a given supply curve, we still need to include demand factors to let us pinpoint where we expect the levels to intersect. In other words, we need to know the external factors that are affecting the \(\textcolor{red}{red}\) and \(\textcolor{blue}{blue}\) lines. As shown above, in equilibrium, those are the only factors for price and quantity.</p>

<h3 id="regression-results">Regression Results</h3>

<p>Finally, we test these ideas directly to see if we can recover our original “true” demand parameters.</p>

<p>Recall, we are looking to retrieve the “true” values from the simulation setup,</p>

\[\begin{aligned}
    P_{demand} &amp;= 100 - Q_{demand} + 2Z_{demand} + u_{demand}
\end{aligned}\]

<h4 id="only-supply-shifters-in-first-stage">Only Supply Shifters in First Stage</h4>

<p>If we only include supply shifters in the first stage regression, i.e.</p>

\[Q = \alpha_1 Z_{supply} + u\]

<p>And use the predicted values, \(\hat{Q}\) in the second stage regression:</p>

\[P = \beta_1 \hat{Q} + \beta_2 Z_{demand} + e\]

<p>Then we obtain baised and inconsistent estimates. We can see the result of this estimation below:</p>

<pre><code class="language-{r}"># first stage 
first_stage_bias_fit &lt;- lm(Q ~ Z_Supply, data = data)
data$`Q Predicted (only supply)` &lt;- predict(first_stage_bias_fit)

# second stage 
fit_bias &lt;- lm(P ~ `Q Predicted (only supply)` + Z_Demand, data = data)
</code></pre>

<p>We see here that these estimates are incorrect based on what we know to be true.</p>

<p><img src="/assets/images/biased-sem.png" alt="scatter" width="500" /></p>

<h4 id="all-exogenous-variables-in-first-stage">All Exogenous Variables in First Stage</h4>

<p>If we now include all exogenous variables in the first stage regression, i.e.</p>

\[Q = \alpha_1 Z_{supply} + \alpha_2 Z_{demand} + u\]

<p>And use these new predicted values, \(\widetilde{Q}\) in the second stage regression:</p>

\[P = \beta_1 \widetilde{Q} + \beta_2 Z_{demand} + e\]

<p>We can retrieve the known true paramater values.</p>

<pre><code class="language-{r}"># first stage 
first_stage_fit &lt;- lm(Q ~ Z_Supply + Z_Demand, data = data)
data$`Q Predicted (all exogenous)` &lt;- predict(first_stage_fit)

# second stage 
fit &lt;- lm(P ~ `Q Predicted (all exogenous)` + Z_Demand, data = data)
</code></pre>

<p><img src="/assets/images/true-sem.png" alt="scatter" width="500" /></p>

<p>In this case, using all exogenous variables in the first stage allows us to recover the “true” demand parameters on quantity and the demand shifter.</p>


    </div>
  </div>

  <div class="d-flex justify-content-center pt-5">
    <h2>More</h2>
  </div>

  <div class="row pt-5">
    <div class="col-sm-6">
      <div class="card info-card sticky-div h-100">

  <div class="card-body">

    <h3 class="card-title text-center">Recent Posts</h3>
  </div>
    <ul class="list-group list-group-flush">
      
        <li class="list-group-item">
          <time datetime="2021-05-07T00:00:00-05:00">May 7, 2021</time> 
          &raquo;
          <a class="card-link" href="/2021/05/07/sem-iv.html">SEM Estimation by 2SLS</a>
        </li>
      
        <li class="list-group-item">
          <time datetime="2021-05-07T00:00:00-05:00">Jan 21, 2021</time> 
          &raquo;
          <a class="card-link" href="/econometrics/statistics/2021/01/21/why-omitted-variables-matter.html">Omitted Variable Bias by Simulation</a>
        </li>
      
        <li class="list-group-item">
          <time datetime="2021-05-07T00:00:00-05:00">Jan 19, 2021</time> 
          &raquo;
          <a class="card-link" href="/statistics/tutorial/2021/01/19/moving-average-in-R.html">Moving Average in R, tidyverse</a>
        </li>
      
        <li class="list-group-item">
          <time datetime="2021-05-07T00:00:00-05:00">Dec 20, 2020</time> 
          &raquo;
          <a class="card-link" href="/machine%20learning/prediction/tutorial/2020/12/20/build-a-neural-network.html">Build a Neural Network with Julia</a>
        </li>
      
        <li class="list-group-item">
          <time datetime="2021-05-07T00:00:00-05:00">Oct 20, 2020</time> 
          &raquo;
          <a class="card-link" href="/econometrics/tutorial/2020/10/20/replicate-robust-stata-errors.html">Replicate STATA Robust Errors</a>
        </li>
      
    </ul>
  <div class="card-body">
  </div>
</div>

    </div>
    <div class="col-sm-6">
        <div class="card info-card sticky-div h-100">

    <div class="card-body">

      <h3 class="card-title text-center">Categories</h3>

      
        <div class="category-tags d-flex flex-wrap justify-content-center">
          
            
            
            
            
            <a class="card-link my-2 py-2 px-3" href="/categories.html#general">
              
              
                General
              
            
            </a>
          
            
            
            
            
            <a class="card-link my-2 py-2 px-3" href="/categories.html#tutorial">
              
              
                Tutorial
              
            
            </a>
          
            
            
            
            
            <a class="card-link my-2 py-2 px-3" href="/categories.html#econometrics">
              
              
                Econometrics
              
            
            </a>
          
            
            
            
            
            <a class="card-link my-2 py-2 px-3" href="/categories.html#machine-learning">
              
              
                Machine
              
                Learning
              
            
            </a>
          
            
            
            
            
            <a class="card-link my-2 py-2 px-3" href="/categories.html#prediction">
              
              
                Prediction
              
            
            </a>
          
            
            
            
            
            <a class="card-link my-2 py-2 px-3" href="/categories.html#statistics">
              
              
                Statistics
              
            
            </a>
          
        </div>
      
    </div>
  </div>
    </div>
  </div>

  
    <div class="row">
      <div class="row mt-4" id="disqus_thread"></div>
<script>
  var disqus_config = function () {
    this.page.url = 'https://sparklingcorrelation.com/2021/05/07/sem-iv.html';
    this.page.identifier = 'https://sparklingcorrelation.com/2021/05/07/sem-iv.html';
  };

  (function() {
    var d = document, s = d.createElement('script');

    s.src = 'https://sparklingcorrelation.disqus.com/embed.js';

    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

    </div>
  
      
</div>
      </main>

    </div>
    <footer class="text-muted">
  <div class="container">
    <div class="row">
      <div class="d-flex justify-content-center">
        <div class="footer-element">
        <p>&copy;2021 Sparkling Correlation</p>
    
</div>
      </div>
    </div>

    
      <div class="row">
        <div class="d-flex justify-content-center">
          <div class="footer-element">
    
        <a class="social-icon" href="mailto:smlee.981@gmail.com" target="_blank">
            <i class="fa-hover fas fa-envelope" title="Email"></i>
        </a>
    
        <a class="social-icon" href="https://twitter.com/slee981" target="_blank">
            <i class="fa-hover fab fa-twitter" title="Twitter"></i>
        </a>
    
        <a class="social-icon" href="https://github.com/slee981" target="_blank">
            <i class="fa-hover fab fa-github" title="GitHub"></i>
        </a>
    
</div>

        </div>
      </div>
    

    
      <div class="row">
        <div class="d-flex justify-content-center">
           <p class="powered-by footer-element mt-3">
    Powered by 
    <a href="https://jekyllrb.com/" target="_blank">Jekyll</a> & 
    <a href="https://github.com/slee981/jekyll-theme-cadre" target="_blank">Cadre</a>
</p>

        </div>
      </div>
    
  </div>
</footer>



    
    
    
      <link rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"
  integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X"
  crossorigin="anonymous">

<!-- The loading of KaTeX is deferred to speed up page rendering -->
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js"
  integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4"
  crossorigin="anonymous"></script>

<!-- To automatically render math in text elements, include the auto-render extension: -->
<script defer
  src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js"
  integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa"
  crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>

    
    
    
      <script async src="https://www.googletagmanager.com/gtag/js?id=UA-138925131-2"></script>
<script>
  window['ga-disable-UA-138925131-2'] = window.doNotTrack === "1" || navigator.doNotTrack === "1" || navigator.doNotTrack === "yes" || navigator.msDoNotTrack === "1";
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-138925131-2');
</script>

    
  </body>
</html>
